@model string
@{
    var label = ViewData["Label"] as string;
    var isRequired = (ViewData["Required"] as bool?) ?? false;
    var help = ViewData["HelpText"] as string;
    var ph = ViewData["Placeholder"] as string;
    var rows = ViewData["Rows"] as int? ?? 3;
}

<div class="space-y-1.5">
    @if (!string.IsNullOrEmpty(label))
    {
        <label class="block text-sm font-semibold text-slate-800">
            @label @if (isRequired) { <span class="text-rose-500">*</span> }
        </label>
    }

    @Html.TextAreaFor(m => m,
        rows,
        0,
        new {
            @class = "auto-grow-textarea w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900 placeholder:text-slate-400 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500/40 transition-all resize-y",
            placeholder = ph
        })

    @Html.ValidationMessageFor(m => m, "", new { @class = "text-xs text-rose-500" })

    @if (!string.IsNullOrEmpty(help))
    {
        <p class="text-xs text-slate-400">@Html.Raw(help)</p>
    }
</div>

<script>
(function () {
  if (window.__autoGrowTextAreaInit) return;
  window.__autoGrowTextAreaInit = true;

  function autoGrow(el) {
    if (!el) return;
    el.style.overflow = 'hidden';
    el.style.height = 'auto';
    el.style.height = el.scrollHeight + 'px';
  }

  function initAll() {
    document.querySelectorAll('textarea.auto-grow-textarea').forEach(t => {
      autoGrow(t);
      t.addEventListener('input', () => autoGrow(t));
    });
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initAll);
  } else {
    initAll();
  }
})();
</script>
